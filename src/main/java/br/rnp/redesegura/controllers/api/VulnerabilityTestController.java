package br.rnp.redesegura.controllers.api;

import br.rnp.redesegura.controllers.routes.Routes;
import br.rnp.redesegura.dto.ServiceCheckDto;
import br.rnp.redesegura.dto.response.VulnerabilityTestResponse;
import br.rnp.redesegura.models.Vulnerability;
import br.rnp.redesegura.services.VulnerabilityService;
import br.rnp.redesegura.services.VulnerabilityTestService;
import jakarta.validation.Valid;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping(Routes.VULNERABILITY_TEST)
public class VulnerabilityTestController {

    @Autowired
    private VulnerabilityTestService vulnerabilityTestService;

    @GetMapping("/{vulnerabilityId}")
    public ResponseEntity<VulnerabilityTestResponse> testVulnerability(@PathVariable("vulnerabilityId") Long vulnerabilityId) {
        return ResponseEntity.ok(vulnerabilityTestService.testVulnerability(vulnerabilityId));
    }

    @PostMapping("/ntp")
    public ResponseEntity<VulnerabilityTestResponse> testNtp(@RequestBody @Valid ServiceCheckDto serviceCheckDto) {
        return ResponseEntity.ok(vulnerabilityTestService.testVulnerability(serviceCheckDto, Vulnerability.VulnerabilityTypeEnum.NTP_DDOS_AMPLIFICATION));
    }

    @PostMapping("/dns")
    public ResponseEntity<VulnerabilityTestResponse> testDns(@RequestBody @Valid ServiceCheckDto serviceCheckDto) {
        return ResponseEntity.ok(vulnerabilityTestService.testVulnerability(serviceCheckDto, Vulnerability.VulnerabilityTypeEnum.DNS_RECURSION));
    }

    @PostMapping("/netbios")
    public ResponseEntity<VulnerabilityTestResponse> testNetbios(@RequestBody @Valid ServiceCheckDto serviceCheckDto) {
        return ResponseEntity.ok(vulnerabilityTestService.testVulnerability(serviceCheckDto, Vulnerability.VulnerabilityTypeEnum.NETBIOS_EXPOSURE));
    }

    @PostMapping("/snmp")
    public ResponseEntity<VulnerabilityTestResponse> testSnmp(@RequestBody @Valid ServiceCheckDto serviceCheckDto) {
        return ResponseEntity.ok(vulnerabilityTestService.testVulnerability(serviceCheckDto, Vulnerability.VulnerabilityTypeEnum.SNMP_PUBLIC_COMMUNITY));
    }

    @PostMapping("/samba")
    public ResponseEntity<VulnerabilityTestResponse> testSamba(@RequestBody @Valid ServiceCheckDto serviceCheckDto) {
        return ResponseEntity.ok(vulnerabilityTestService.testVulnerability(serviceCheckDto, Vulnerability.VulnerabilityTypeEnum.SAMBA_OUTDATED_VERSION));
    }

    @PostMapping("/mysql")
    public ResponseEntity<VulnerabilityTestResponse> testMysql(@RequestBody @Valid ServiceCheckDto serviceCheckDto) {
        return ResponseEntity.ok(vulnerabilityTestService.testVulnerability(serviceCheckDto, Vulnerability.VulnerabilityTypeEnum.EXPOSED_MYSQL));
    }

    @PostMapping("/redis")
    public ResponseEntity<VulnerabilityTestResponse> testRedis(@RequestBody @Valid ServiceCheckDto serviceCheckDto) {
        return ResponseEntity.ok(vulnerabilityTestService.testVulnerability(serviceCheckDto, Vulnerability.VulnerabilityTypeEnum.REDIS_NO_AUTHENTICATION));
    }

    @PostMapping("/ssdp")
    public ResponseEntity<VulnerabilityTestResponse> testSsdp(@RequestBody @Valid ServiceCheckDto serviceCheckDto) {
        return ResponseEntity.ok(vulnerabilityTestService.testVulnerability(serviceCheckDto, Vulnerability.VulnerabilityTypeEnum.EXPOSED_SSDP));
    }

    @PostMapping("/memcached")
    public ResponseEntity<VulnerabilityTestResponse> testMemcached(@RequestBody @Valid ServiceCheckDto serviceCheckDto) {
        return ResponseEntity.ok(vulnerabilityTestService.testVulnerability(serviceCheckDto, Vulnerability.VulnerabilityTypeEnum.EXPOSED_MEMCACHED));
    }

    @PostMapping("/slp")
    public ResponseEntity<VulnerabilityTestResponse> testSlp(@RequestBody @Valid ServiceCheckDto serviceCheckDto) {
        return ResponseEntity.ok(vulnerabilityTestService.testVulnerability(serviceCheckDto, Vulnerability.VulnerabilityTypeEnum.EXPOSED_SLP));
    }


}
