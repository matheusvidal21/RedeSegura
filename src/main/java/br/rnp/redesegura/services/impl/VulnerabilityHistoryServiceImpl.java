package br.rnp.redesegura.services.impl;

import br.rnp.redesegura.models.Vulnerability;
import br.rnp.redesegura.models.VulnerabilityHistory;
import br.rnp.redesegura.repositories.VulnerabilityHistoryRepository;
import br.rnp.redesegura.services.VulnerabilityHistoryService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class VulnerabilityHistoryServiceImpl implements VulnerabilityHistoryService {

    @Autowired
    private VulnerabilityHistoryRepository vulnerabilityHistoryRepository;

    @Override
    public void createHistory(Vulnerability vulnerability, String actionTaken) {
        VulnerabilityHistory history = VulnerabilityHistory.builder()
                .vulnerability(vulnerability)
                .title(vulnerability.getTitle())
                .severity(vulnerability.getSeverity())
                .status(vulnerability.getStatus())
                .description(vulnerability.getType().getName() + "-" + vulnerability.getType().getDescription())
                .actionTaken(actionTaken)
                .build();
        vulnerabilityHistoryRepository.save(history);
    }

    @Override
    public List<VulnerabilityHistory> getHistoryForVulnerability(Long vulnerabilityId) {
        return vulnerabilityHistoryRepository.findByVulnerabilityId(vulnerabilityId);
    }
}
